{% extends "main.html" %}
{% block head %}
{{ super() }}
<script src="{{ url_for('static', filename='js/pretty-print-json.min.js') }}"></script>
<script src="{{ url_for('static', filename='js/utils.js') }}"></script>
<link rel="stylesheet" href="{{ url_for('static', filename='css/pretty-print-json.css') }}" />
{% endblock %}
{% block title %}Bundle - {{ bundle.name }}{% endblock %}
{% block content %}
<h1><a href="{{ url_for('bundle_bp.get', bundle_uuid=bundle.uuid) }}">{{ bundle.name }}</a></h1>
<p>Created on {{ bundle.creation_timestamp | datetimeformat }} and updated on {{ bundle.timestamp | datetimeformat }}.</p>
<h2>Description</h2>
<span id="markdown-description" class="markdown-description">{{ description  | safe }}</span>
<h2>Vulnerabilities included in this bundle</h2>
<ul class="list-group">
  {% for vuln in bundle.related_vulnerabilities %}
  <li class="list-group-item"><a href="{{ url_for('home_bp.vulnerability_view', vulnerability_id=vuln) }}">{{ vuln }}</a></li>
  {% endfor %}
</ul>
{% if bundle.meta %}
<h2>Meta</h2>
<pre id="jsoncontainer">{{ bundle.meta | tojson(indent=2) }}</pre>
{% endif %}
<h2>Author</h2>
<a href="{{ url_for('user_bp.profile', login=bundle.author.login) }}">{{ bundle.author.name }}</a>
<hr />
<div class="btn-group" role="group">
  <div class="btn-group" role="group">
    <button id="btnGroupDropShare" type="button" class="btn btn-primary" data-bs-toggle="dropdown" aria-expanded="false">
      Share {{ render_icon('chevron-down') }}
    </button>
    <ul class="dropdown-menu" aria-labelledby="btnGroupDropShare">
      <li><a class="dropdown-item" href="https://news.ycombinator.com/submitlink?u=https://{{ config.PUBLIC_DOMAIN }}{{ url_for('bundle_bp.get', bundle_uuid=bundle.uuid) }}&t={{ bundle.name }}" target="_blank" title="Share on Hacker News">Hacker News</a></li>
      <li><a class="dropdown-item" href="https://www.linkedin.com/shareArticle?mini=true&url=https://{{ config.PUBLIC_DOMAIN }}{{ url_for('bundle_bp.get', bundle_uuid=bundle.uuid) }}&title={{ bundle.name }}" target="_blank" title="Share on LinkedIn">LinkedIn</a></li>
      <li><a class="dropdown-item" href="https://mastodonshare.com/?text={{ bundle.name }}&url=https://{{ config.PUBLIC_DOMAIN }}{{ url_for('bundle_bp.get', bundle_uuid=bundle.uuid) }}" target="_blank" title="Share on Mastodon">Mastodon</a></li>
      <li><a class="dropdown-item" href="https://www.newspipe.org/bookmark/bookmarklet?href=https://{{ config.PUBLIC_DOMAIN }}{{ url_for('bundle_bp.get', bundle_uuid=bundle.uuid) }}&title={{ bundle.name }}" target="_blank" title="Share on Newspipe">Newspipe</a></li>
      <li><a class="dropdown-item" href="https://api.pinboard.in/v1/posts/add?url=https://{{ config.PUBLIC_DOMAIN }}{{ url_for('bundle_bp.get', bundle_uuid=bundle.uuid) }}&description=%27{{ bundle.name }}" target="_blank" title="Share on Pinboard">Pinboard</a></li>
      <li><a class="dropdown-item" href="https://reddit.com/submit?url=https://{{ config.PUBLIC_DOMAIN }}{{ url_for('bundle_bp.get', bundle_uuid=bundle.uuid) }}&title=%27{{ bundle.name }}%27" target="_blank" title="Share on Reddit">Reddit</a></li>
    </ul>
  </div>
  <div class="btn-group" role="group">
    <a role="button" class="btn btn-primary dropdown-toggle" data-bs-toggle="collapse" data-bs-target="#collapseJsonBundle" aria-expanded="false" aria-controls="collapseJsonBundle">JSON</a>
  </div>
  {% if current_user.is_authenticated and current_user.is_admin %}
  <a type="button" class="btn btn-primary" title="Edit" aria-label="Edit" href="{{ url_for('admin_bp.form_bundle', bundle_uuid=bundle.uuid) }}">Edit</a>
  <a role="button" class="btn btn-danger" title="Delete" aria-label="Delete" href="{{ url_for('admin_bp.delete_bundle', bundle_uuid=bundle.uuid) }}" onclick="return confirm('You are going to delete this bundle.');">Delete</a>
  {% endif %}
</div>
<div class="collapse" id="collapseJsonBundle"><br /><pre class="json-container">{{ bundle.as_json() }}</pre></div>
<br /><br />
<script>
  document.addEventListener("DOMContentLoaded", function() {
    jsonContainer = document.getElementById("jsoncontainer");
    if (jsonContainer) {
      jsonContainer.innerHTML = prettyPrintJson.toHtml(JSON.parse(jsonContainer.innerText));
    }
    // Post formatting
    document.getElementById("markdown-description").innerHTML = linkifySecurityIdentifiers(document.getElementById("markdown-description").innerHTML);
    formatMarkdownOutput();
  });
</script>
{% endblock %}
