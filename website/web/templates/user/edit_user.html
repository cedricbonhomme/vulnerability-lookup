{% extends "main.html" %}
{% from 'bootstrap5/form.html' import render_form %}
{% block head %}
{{ super() }}
<script src="{{ url_for('static', filename='js/easymde.min.js') }}"></script>
<link rel="stylesheet" href="{{ url_for('static', filename='css/easymde.min.css') }}" />
{% endblock %}
{% block title %}{{ action }}{% endblock %}
{% block content %}
<h1>Profile</h1>
{{ render_form(form) }}
<br /><hr />
<div class="row">
    <div class="col">
        <div class="input-group">
            <span class="input-group-text">API key</span>
            <input type="text" class="form-control" id="inlineFormInputGroupAPIKey" value="{{ current_user.apikey }}" readonly>
            <button class="btn btn-outline-primary" type="button" onclick="copyToClipboard()">{{ render_icon('clipboard', title='Copy to clipboard') }}</button>
            <a class="btn btn-outline-primary" type="button" href="{{ url_for('user_bp.generate_apikey', user_id=user.id) }}">Generate new API key</a>
        </div>
        <p class="pt-3">This API key can be used for authenticated requests to the <a href="{{ url_for('apiv1.doc') }}">API</a>.</p>
  </div>
</div>
<hr /><br />
<a href="{{ url_for('user_bp.delete_account') }}" class="btn btn-warning" onclick="return confirm('You are going to delete your account.');">Delete your account</a>
{% if not config["ENFORCE_2FA"] %}
<a href="{{ url_for('user_bp.toggle_2FA') }}" class="btn btn-warning">{% if user.is_two_factor_authentication_enabled %}Disable{% else %}Enable{% endif %} 2FA</a>
{% endif %}
<br /><br />
<p>Deleting your account will not impact any of the contributions you have previously made.</p>
<script>
  function copyToClipboard() {
    const copyText = document.getElementById("inlineFormInputGroupAPIKey").value;
    const textArea = document.createElement('textarea');
    textArea.textContent = copyText;
    // document.body.append(textArea);
    // textArea.select();
    navigator.clipboard.writeText(textArea.value).then(function() {
          /* clipboard successfully set */
          alert('API key copied to your clipboard.');
        }, function() {
          /* clipboard write failed */
    });
  }

  easyMDE = new EasyMDE({
    element: document.getElementById('bio'),
    autoRefresh: { delay: 300 },
    toolbarButtonClassPrefix: "mde",
    toolbar: [
      "bold", "italic", "heading", "|", "unordered-list", "ordered-list", "|", "preview", "side-by-side", "fullscreen"
    ]
  });
</script>
{% endblock %}
