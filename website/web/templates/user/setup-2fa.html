{% extends "main.html" %}
{% from 'bootstrap5/form.html' import render_form %}
{% block title %}Setup Two-Factor Authentication{% endblock %}
{% block content %}
<div class="row">
  <div class="col-md-6">
    <h5>Complete the two-factor authentication setup.</h5>
  </div>
</div>
<div class="row">
  <div class="col-md-6">
      <ol class="list-group list-group-numbered">
        <li class="list-group-item">Install an authenticator application on your mobile device.</li>
        <li class="list-group-item">Scan the QR code or manually copy the secret token.</li>
        <li class="list-group-item">Submit the OTP generated by your device in the form.</li>
      </ol>
      <div class="text-center">
        <img src="data:image/png;base64, {{ qr_image }}" alt="Secret Token" style="width:300px;height:300px"/>
      </div>
      <div class="form-group">
        <label for="secret">Secret token</label>
      </div>

      <div class="input-group">
        <input type="text" class="form-control" id="secret" value="{{ secret }}" readonly>
        <button class='btn btn-primary input-group-text' id='copySecret'>Copy</button>
      </div>
  </div>
  <div class="col-md-6">
    <form class="form form-control" method="POST" action="{{ url_for('user_bp.verify_two_factor_auth') }}">
      {{ form.hidden_tag() }}
      {{ form.otp(placeholder="OTP", class="form-control", autofocus=true) }}
      {{ form.otp.description }}
      {{ form.submit(class_="btn btn-primary form-control") }}
  </form>
  </div>
</div>
{% block js %}
<script>
document.addEventListener("DOMContentLoaded", function() {
  document.getElementById("copySecret").onclick = function(event) {
    var copyText = document.getElementById("secret");
    navigator.clipboard.writeText(copyText.value).then(function() {
      /* clipboard successfully set */
      alert("Successfully copied TOTP secret token!");
    }, function() {
      /* clipboard write failed */
    });
  };
});
</script>
{% endblock %}
{% endblock %}
