{% from 'bootstrap5/utils.html' import render_icon %}
{% macro table_users(users) %}
<div class="table-responsive-md">
    <table id="table-users" class="table table-hover">
    <thead>
        <tr>
            <th>id</th>
            <th>Login</th>
            <th>Email address</th>
            <th><a style="text-decoration:underline dotted" href="{{ request.url | update_query(sort='organisation') }}">Organisation</a></th>
            <th>Country</th>
            <th>Permissions</th>
            <th>State</th>
            <th><a style="text-decoration:underline dotted" href="{{ request.url | update_query(sort='member_since') }}">Member since</a></th>
            <th><a style="text-decoration:underline dotted" href="{{ request.url | update_query(sort='last_seen') }}">Last seen</a></th>
            <th>Actions</th>
        </tr>
    </thead>
    <tbody>
    {% for user in users %}
        <tr>
            <th scope="row">{{ user.id }}</th>
            <td><a href="{{ url_for('user_bp.profile', login=user.login) }}">{{ user.login  }}</a></td>
            <td><a href="mailto:{{ user.email }}">{{ user.email }}</a></td>
            <td><a href="{{ request.url | update_query(organisation=user.organisation) }}">{{ user.organisation }}</a></td>
            <td><a href="{{ request.url | update_query(country=user.country_code) }}">{{ user.country_code }}</a></td>
            <td>
              {% for permission in user.permissions() %}
                <a href="{{ request.url | update_query(permission=permission) }}">{{ permission }}</a>
              {% endfor %}
            </td>
            <td>
                {% if user.is_active %}{{ render_icon('lock', title='Account active', color='green') }}{% else %}{{ render_icon('lock', title='Account inactive', color='red') }}{% endif %}
                {% if user.is_confirmed %}{{ render_icon('check', title='Account confirmed', color='green') }}{% else %}{{ render_icon('check', title='Account not confirmed', color='red') }}{% endif %}
                {% if user.is_two_factor_authentication_enabled %}{{ render_icon('key', title='Two-Factor Authentication enabled', color='green') }}{% else %}{{ render_icon('key', title='Two-Factor Authentication not enabled', color='red') }}{% endif %}
            </td>
            <td class="date">{{ user.created_at | datetimeformat }}</td>
            <td class="date">{{ user.last_seen | datetimeformat }}</td>
            <td>
                <a class="icon-link" href="{{ url_for('admin_bp.form_user', user_id=user.id) }}">{{ render_icon('pen', title='Edit the user') }}</a>
                {% if current_user.id != user.id %}
                <a class="icon-link" href="{{ url_for('admin_bp.toggle_user', user_id=user.id) }}">{% if not user.is_active  %}{{ render_icon('unlock', title='Activate the account') }}{% else %}{{ render_icon('lock', title='Deactivate the account') }}{% endif %}</a>
                <a class="icon-link" href="{{ url_for('admin_bp.reset_two_factor_auth', user_id=user.id) }}">{{ render_icon('arrow-clockwise', title='Reset Two-Factor Authentication') }}</a>
                <a class="icon-link" href="{{ url_for('admin_bp.delete_user', user_id=user.id) }}" onclick="return confirm('You are going to delete this user and their data.');">{{ render_icon('trash', color='red') }}</a>
                {% endif %}
            </td>
        </tr>
    {% endfor %}
    </tbody>
    </table>
</div>
{%- endmacro %}
